/*! iptools-jquery-modal - v0.1.2 - 2015-08-24
* https://github.com/interactive-pioneers/iptools-jquery-modal
* Copyright Â© 2015 Interactive Pioneers GmbH; Licensed GPL-3.0 */
!function(a,b,c){"use strict";function d(d,f){function g(){return W.find("."+S.modalClass+P.elements.content)}function h(){return S.modifiers.length>0?" "+S.modifiers:""}function i(){W&&(W.remove(),W=null)}function j(){_.element.off("ajax:complete").off("ajax:success").off("ajax:error")}function k(){a(c).off(s("keydown")+" "+s("mouseup")),a(b).off(s("resize"))}function l(){_.element.on(s("click"),m)}function m(b){b.preventDefault();var c=a(b.currentTarget);_.open({link:c.attr("href"),unobtrusive:c.data("remote")})}function n(b){i(),$=v(b);var c=a("<div/>").addClass(S.modalClass+P.elements.content);return a("<div/>",{id:S.modalId,width:S.width,height:S.height,"class":S.modalClass+h()}).data("type",$).append(c)}function o(){Z=!1,z(),S.showSpinner&&B(),_.element.trigger(s("ready"))}function p(){C(),_.element.trigger(s("complete"))}function q(){p(),Z=!0,w(),F(),t(),_.element.trigger(s("success"))}function r(){p(),A(),_.element.trigger(s("error"))}function s(a){return a+"."+e}function t(){Y&&W.addClass(S.modalClass+P.effectModifierPrefix+Y),D(),W.addClass(S.modalClass+P.activeModifier)}function u(){W.removeClass(S.modalClass+P.activeModifier)}function v(b){if(b.unobtrusive)return O.UNOBTRUSIVE;if(b.link&&"#"===b.link.charAt(0)&&!b.unobtrusive){if(0===a(b.link).length)throw new Error("Modal content not found!");return O.STATIC}return O.DYNAMIC}function w(){S.closeButton&&(V=a("<div/>").addClass(S.modalClass+P.elements.closeButton).appendTo(W))}function x(){S.overlay&&!X&&(X=a("<div/>").addClass(S.overlayClass).appendTo("body"))}function y(){X&&(X.remove(),X=null)}function z(){S.overlay&&(X||x(),X.fadeIn(S.animationDuration))}function A(){S.overlay&&X&&X.fadeOut(S.animationDuration)}function B(){U||(U=a("<div/>").addClass(S.modalClass+P.elements.spinner).addClass(S.spinnerClass).append(S.spinnerHTML)),a("body").append(U),U.show()}function C(){U&&(U.hide(),U.remove())}function D(){W.css({position:"fixed",top:"50%",left:"50%",marginTop:.5*-W.outerHeight(),marginLeft:.5*-W.outerWidth(),zIndex:S.zIndex})}function E(){var a=g().css("height","auto"),b=W.height(),c=a.innerHeight(),d=W.innerHeight()-W.height(),e=c>b?W.innerHeight()-d+"px":"auto";a.css("height",e),D()}function F(){V&&V.on(s("click"),_.close),S.closeOnESC&&a(c).on(s("keydown"),K),S.closeOnClickOutside&&a(c).on(s("mouseup"),L),a(b).on(s("resize"),_,M)}function G(){_.element.on("ajax:complete",H).on("ajax:success",I).on("ajax:error",J)}function H(){p()}function I(){q()}function J(){r()}function K(a){27===a.which&&_.close()}function L(a){W.is(a.target)||0!==W.has(a.target).length||_.close()}function M(a){var b=a.data;"undefined"!=typeof b.resizeTimeout&&clearTimeout(b.resizeTimeout),b.resizeTimeout=setTimeout(function(){D(),E()},250)}function N(){Y=_.element.data(Q.effect),T=_.element.attr("href"),l()}var O={STATIC:"static",DYNAMIC:"dynamic",UNOBTRUSIVE:"unobtrusive"},P={activeModifier:"--active",effectModifierPrefix:"--effect-",modal:"modal",overlay:"overlay",spinnerModifier:"--default",elements:{closeButton:"__button-close",spinner:"__spinner",content:"__content"}},Q={effect:"modal-effect"},R={width:"auto",height:"auto",zIndex:102,closeOnESC:!0,closeOnClickOutside:!0,closeButton:!0,modalClass:P.modal,showSpinner:!0,spinnerClass:P.modal+P.elements.spinner+P.spinnerModifier,spinnerHTML:"",modalId:P.modal,modifiers:"",overlay:!0,overlayClass:P.overlay,animationDuration:500};this.element=a(d);var S=a.extend({},R,f),T=null,U=null,V=null,W=null,X=null,Y=null,Z=!1,$=O.STATIC,_=this;this.getSettings=function(){return S},this.getModal=function(){return W},this.getOverlay=function(){return X},this.getEffect=function(){return Y},this.active=function(){return W.hasClass(P.modal+P.activeModifier)},this.destroy=function(){k(),j(),i(),y(),this.element.off(s("click")).removeData("plugin_"+e)},this.open=function(b){if(!b)throw new Error("Data for modal launch missing!");if(!b.link)throw new Error("Link for modal content missing!");switch(x(),W=n(b).appendTo("body"),setTimeout(E,0),o(),$){case O.STATIC:_.setContent(a(T).html()),q();break;case O.DYNAMIC:a.get(T).done(function(a){_.setContent(a),q()}).fail(function(){r()});break;case O.UNOBTRUSIVE:G();break;default:throw new Error("Erroneous modal type!")}},this.close=function(){u(),k(),j(),A(),i()},this.setContent=function(a){W.find("."+S.modalClass+P.elements.content).html(a)},N()}var e="iptModal";a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new d(this,b))})}}(jQuery,window,document);