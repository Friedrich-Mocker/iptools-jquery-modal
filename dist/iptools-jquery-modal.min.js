/*! iptools-jquery-modal - v0.1.1 - 2015-08-14
* https://github.com/interactive-pioneers/iptools-jquery-modal
* Copyright Â© 2015 Interactive Pioneers GmbH; Licensed GPL-3.0 */
!function(a,b,c){"use strict";function d(d,f){function g(){return S.find("."+O.modalClass+L.elements.content)}function h(){return O.modifiers.length>0?" "+O.modifiers:""}function i(){S&&(S.remove(),S=null)}function j(){W.element.off("ajax:complete").off("ajax:success").off("ajax:error")}function k(){a(c).off(s("keydown")+" "+s("mouseup")),a(b).off(s("resize"))}function l(){W.element.on(s("click"),m)}function m(b){b.preventDefault();var c=a(b.currentTarget);W.open({link:c.attr("href"),unobtrusive:c.data("remote")})}function n(b){i(),V=v(b);var c=a("<div/>").addClass(O.modalClass+L.elements.content);return a("<div/>",{id:O.modalId,width:O.width,height:O.height,"class":O.modalClass+h()}).data("type",V).append(c)}function o(){U=!1,O.showSpinner&&x(),W.element.trigger(s("ready"))}function p(){y(),W.element.trigger(s("complete"))}function q(){p(),U=!0,w(),B(),t(),W.element.trigger(s("success"))}function r(){p(),W.element.trigger(s("error"))}function s(a){return a+"."+e}function t(){T&&S.addClass(O.modalClass+L.effectModifierPrefix+T),z(),S.addClass(O.modalClass+L.activeModifier)}function u(){S.removeClass(O.modalClass+L.activeModifier)}function v(b){if(b.unobtrusive)return K.UNOBTRUSIVE;if(b.link&&"#"===b.link.charAt(0)&&!b.unobtrusive){if(0===a(b.link).length)throw new Error("Modal content not found!");return K.STATIC}return K.DYNAMIC}function w(){O.closeButton&&(R=a("<div/>").addClass(O.modalClass+L.elements.closeButton).appendTo(S))}function x(){Q||(Q=a("<div/>").addClass(O.modalClass+L.elements.spinner).addClass(O.spinnerClass).append(O.spinnerHTML)),a("body").append(Q),Q.show()}function y(){Q&&(Q.hide(),Q.remove())}function z(){S.css({position:"fixed",top:"50%",left:"50%",marginTop:.5*-S.outerHeight(),marginLeft:.5*-S.outerWidth(),zIndex:O.zIndex})}function A(){var a=g().css("height","auto"),b=S.height(),c=a.innerHeight(),d=S.innerHeight()-S.height(),e=c>b?S.innerHeight()-d+"px":"auto";a.css("height",e),z()}function B(){R&&R.on(s("click"),W.close),O.closeOnESC&&a(c).on(s("keydown"),G),O.closeOnClickOutside&&a(c).on(s("mouseup"),H),a(b).on(s("resize"),W,I)}function C(){W.element.on("ajax:complete",D).on("ajax:success",E).on("ajax:error",F)}function D(){p()}function E(){q()}function F(){r()}function G(a){27===a.which&&W.close()}function H(a){S.is(a.target)||0!==S.has(a.target).length||W.close()}function I(a){var b=a.data;"undefined"!=typeof b.resizeTimeout&&clearTimeout(b.resizeTimeout),b.resizeTimeout=setTimeout(function(){z(),A()},250)}function J(){T=W.element.data(M.effect),P=W.element.attr("href"),l()}var K={STATIC:"static",DYNAMIC:"dynamic",UNOBTRUSIVE:"unobtrusive"},L={activeModifier:"--active",effectModifierPrefix:"--effect-",modal:"modal",spinnerModifier:"--default",elements:{closeButton:"__button-close",spinner:"__spinner",content:"__content"}},M={effect:"modal-effect"},N={width:"auto",height:"auto",zIndex:102,closeOnESC:!0,closeOnClickOutside:!0,closeButton:!0,modalClass:L.modal,showSpinner:!0,spinnerClass:L.modal+L.elements.spinner+L.spinnerModifier,spinnerHTML:"",modalId:L.modal,modifiers:""};this.element=a(d);var O=a.extend({},N,f),P=null,Q=null,R=null,S=null,T=null,U=!1,V=K.STATIC,W=this;this.getSettings=function(){return O},this.getModal=function(){return S},this.getEffect=function(){return T},this.active=function(){return S.hasClass(L.modal+L.activeModifier)},this.destroy=function(){k(),j(),i(),this.element.off(s("click")).removeData("plugin_"+e)},this.open=function(b){if(!b)throw new Error("Data for modal launch missing!");if(!b.link)throw new Error("Link for modal content missing!");switch(S=n(b).appendTo("body"),setTimeout(A,0),o(),V){case K.STATIC:W.setContent(a(P).html()),q();break;case K.DYNAMIC:a.get(P).done(function(a){W.setContent(a),q()}).fail(function(){r()});break;case K.UNOBTRUSIVE:C();break;default:throw new Error("Erroneous modal type!")}},this.close=function(){u(),k(),j(),i()},this.setContent=function(a){S.find("."+O.modalClass+L.elements.content).html(a)},J()}var e="iptModal";a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new d(this,b))})}}(jQuery,window,document);