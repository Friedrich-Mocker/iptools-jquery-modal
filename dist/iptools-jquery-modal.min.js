/*! iptools-jquery-modal - v0.1.0 - 2015-08-14
* https://github.com/interactive-pioneers/iptools-jquery-modal
* Copyright Â© 2015 Interactive Pioneers GmbH; Licensed GPL-3.0 */
!function(a,b,c){"use strict";function d(d,f){function g(){return R.find("."+N.modalClass+K.elements.content)}function h(){R&&(R.remove(),R=null)}function i(){V.element.off("ajax:complete").off("ajax:success").off("ajax:error")}function j(){a(c).off(r("keydown")+" "+r("mouseup")),a(b).off(r("resize"))}function k(){V.element.on(r("click"),l)}function l(b){b.preventDefault();var c=a(b.currentTarget);V.open({link:c.attr("href"),unobtrusive:c.data("remote")})}function m(b){h(),U=u(b);var c=a("<div/>").addClass(N.modalClass+K.elements.content);return a("<div/>",{id:N.modalId,width:N.width,height:N.height,"class":N.modalClass}).data("type",U).append(c)}function n(){T=!1,w(),V.element.trigger(r("ready"))}function o(){x(),V.element.trigger(r("complete"))}function p(){console.log("success!"),o(),T=!0,v(),A(),s(),V.element.trigger(r("success"))}function q(){o(),V.element.trigger(r("error"))}function r(a){return a+"."+e}function s(){console.log("showing"),S&&(console.log("effect",N.modalClass+K.effectModifierPrefix+S),R.addClass(N.modalClass+K.effectModifierPrefix+S)),y(),R.addClass(N.modalClass+K.activeModifier)}function t(){R.removeClass(N.modalClass+K.activeModifier)}function u(b){if(b.unobtrusive)return J.UNOBTRUSIVE;if(b.link&&"#"===b.link.charAt(0)&&!b.unobtrusive){if(0===a(b.link).length)throw new Error("Modal content not found!");return J.STATIC}return J.DYNAMIC}function v(){N.closeButton&&(Q=a("<div/>").addClass(N.modalClass+K.elements.closeButton).appendTo(R))}function w(){N.showSpinner&&(P||(P=a("<div/>").addClass(N.modalClass+K.elements.spinner).addClass(N.spinnerClass).append(N.spinnerHTML)),a("body").append(P),P.show())}function x(){P&&(P.hide(),P.remove())}function y(){R.css({position:"fixed",top:"50%",left:"50%",marginTop:.5*-R.outerHeight(),marginLeft:.5*-R.outerWidth(),zIndex:N.zIndex})}function z(){var a=g().css("height","auto"),b=R.height(),c=a.innerHeight(),d=R.innerHeight()-R.height(),e=c>b?R.innerHeight()-d+"px":"auto";a.css("height",e),y()}function A(){Q&&Q.on(r("click"),V.close),N.closeOnESC&&a(c).on(r("keydown"),F),N.closeOnClickOutside&&a(c).on(r("mouseup"),G),a(b).on(r("resize"),V,H)}function B(){V.element.on("ajax:complete",C).on("ajax:success",D).on("ajax:error",E)}function C(){o()}function D(){p()}function E(){q()}function F(a){27===a.which&&V.close()}function G(a){R.is(a.target)||0!==R.has(a.target).length||V.close()}function H(a){var b=a.data;"undefined"!=typeof b.resizeTimeout&&clearTimeout(b.resizeTimeout),b.resizeTimeout=setTimeout(function(){y(),z()},250)}function I(){S=V.element.data(L.effect),O=V.element.attr("href"),k()}var J={STATIC:"static",DYNAMIC:"dynamic",UNOBTRUSIVE:"unobtrusive"},K={activeModifier:"--active",effectModifierPrefix:"--effect-",modal:"modal",spinnerModifier:"--default",elements:{closeButton:"__button-close",spinner:"__spinner",content:"__content"}},L={effect:"modal-effect"},M={width:"auto",height:"auto",zIndex:102,closeOnESC:!0,closeOnClickOutside:!0,closeButton:!0,modalClass:K.modal,showSpinner:!0,spinnerClass:K.elements.spinner+K.spinnerModifier,spinnerHTML:"",modalId:K.modal};this.element=a(d);var N=a.extend({},M,f),O=null,P=null,Q=null,R=null,S=null,T=!1,U=J.STATIC,V=this;this.getSettings=function(){return N},this.getModal=function(){return R},this.getEffect=function(){return S},this.active=function(){return R.hasClass(K.modal+K.activeModifier)},this.destroy=function(){j(),i(),h(),this.element.off(r("click")).removeData("plugin_"+e)},this.open=function(b){if(!b)throw new Error("Data for modal launch missing!");if(!b.link)throw new Error("Link for modal content missing!");switch(R=m(b).appendTo("body"),setTimeout(z,0),n(),U){case J.STATIC:V.setContent(a(O).html()),p();break;case J.DYNAMIC:a.get(O).done(function(a){V.setContent(a),p()}).fail(function(){q()});break;case J.UNOBTRUSIVE:n(),B();break;default:throw new Error("Erroneous modal type!")}},this.close=function(){t(),j(),i(),h()},this.setContent=function(a){R.find("."+N.modalClass+K.elements.content).html(a)},I()}var e="iptModal";a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new d(this,b))})}}(jQuery,window,document);