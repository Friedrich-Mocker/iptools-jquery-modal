/*! iptools-jquery-modal - v0.2.4 - 2016-02-16
* https://github.com/interactive-pioneers/iptools-jquery-modal
* Copyright Â© 2016 Interactive Pioneers GmbH; Licensed GPL-3.0 */
!function(a,b,c){"use strict";function d(d,f){function g(){return R.modifiers.length>0?" "+R.modifiers:""}function h(){V&&(V.remove(),V=null,Y=!1)}function i(){aa.element.off("ajax:complete").off("ajax:success").off("ajax:error")}function j(){a(c).off(r("keydown")).off(r("mouseup")).off(r("touchstart")),a(b).off(r("resize"))}function k(){aa.element.on(r("click"),l)}function l(b){b.preventDefault();var c=a(b.currentTarget);aa.open({link:S,unobtrusive:c.data("remote")})}function m(b){h(),_=u(b);var c=a("<div/>").addClass(R.modalClass+O.elements.content);return a("<div/>",{"class":R.modalClass+g(),id:R.modalId,width:R.width,height:R.height}).css("z-index",R.zIndex).data("type",_).data("instance",aa).append(c)}function n(){Y=!1,z(),R.showSpinner&&B(),aa.element.trigger(r("ready"))}function o(){C(),aa.element.trigger(r("complete"))}function p(){o(),Y=!0,w(),E(),s(),aa.element.trigger(r("success"))}function q(){o(),A(),aa.element.trigger(r("error"))}function r(a){return a+"."+e}function s(){X&&V.addClass(R.modalClass+O.effectModifierPrefix+X),D(),V.addClass(R.modalClass+O.activeModifier)}function t(){V.removeClass(R.modalClass+O.activeModifier)}function u(b){if(b.unobtrusive)return N.UNOBTRUSIVE;if(b.link&&"#"===b.link.charAt(0)&&!b.unobtrusive){if(0===a(b.link).length)throw new Error("Modal content not found!");return N.STATIC}return N.DYNAMIC}function v(a){if(a.data("remote")&&a.data("url"))return a.data("url");if(a.attr("href"))return a.attr("href");throw new Error("Link undefined!")}function w(){R.closeButton&&(W=a("<div/>").addClass(R.closeButtonClass).appendTo(R.addCloseButtonToOverlay?U:V))}function x(){U||(U=a("<div/>").addClass(R.overlayClass).appendTo("body"))}function y(){U&&(U.remove(),U=null)}function z(){Z=!0,a("body").css("overflow","hidden"),U||x(),U.stop().fadeIn(R.animationDuration)}function A(){U&&U.stop().fadeOut(R.animationDuration),a("body").css("overflow","auto"),Z=!1}function B(){T||(T=a("<div/>").addClass(R.modalClass+O.elements.spinner).addClass(R.spinnerClass).append(R.spinnerHTML)),T.appendTo(U).show()}function C(){T&&(T.hide(),T.remove())}function D(){var a=V.outerHeight(),b=U.height();a>b?V.removeClass(R.modalVAlignCenterClass).addClass(R.modalVAlignTopClass):V.removeClass(R.modalVAlignTopClass).addClass(R.modalVAlignCenterClass)}function E(){W&&W.on(r("click"),aa.close),R.closeOnESC&&a(c).on(r("keydown"),J),R.closeOnClickOutside&&a(c).on(r("mouseup"),K).on(r("touchstart"),K),a(b).on(r("resize"),L)}function F(){aa.element.on("ajax:complete",G).on("ajax:success",H).on("ajax:error",I)}function G(){o()}function H(){p()}function I(){q()}function J(a){Z&&27===a.which&&aa.close()}function K(a){Z&&!V.is(a.target)&&0===V.has(a.target).length&&aa.close()}function L(){clearTimeout($),$=setTimeout(D,250)}function M(){X=aa.element.data(P.effect),S=v(aa.element),k()}var N={STATIC:"static",DYNAMIC:"dynamic",UNOBTRUSIVE:"unobtrusive"},O={activeModifier:"--active",effectModifierPrefix:"--effect-",overlay:"overlay",spinnerModifier:"--default",modal:{name:"modal",verticalAlignTop:"modal--vertical-align-top",verticalAlignCenter:"modal--vertical-align-center"},elements:{closeButton:"__button-close",spinner:"__spinner",content:"__content"}},P={effect:"modal-effect"},Q={animationDuration:500,closeOnESC:!0,closeOnClickOutside:!0,closeButton:!0,closeButtonClass:O.modal.name+O.elements.closeButton,addCloseButtonToOverlay:!1,overlayClass:O.overlay,modalClass:O.modal.name,modalId:O.modal.name,modalVAlignTopClass:O.modal.verticalAlignTop,modalVAlignCenterClass:O.modal.verticalAlignCenter,modifiers:"",showSpinner:!0,spinnerClass:O.modal.name+O.elements.spinner+O.spinnerModifier,spinnerHTML:"",width:"80%",height:"auto",zIndex:102};this.element=a(d);var R=a.extend({},Q,f),S=null,T=null,U=null,V=null,W=null,X=null,Y=!1,Z=!1,$=0,_=N.STATIC,aa=this;this.getSettings=function(){return R},this.getModal=function(){return V},this.getOverlay=function(){return U},this.getEffect=function(){return X},this.active=function(){return V.hasClass(R.modalClass+O.activeModifier)},this.destroy=function(){j(),i(),h(),y(),this.element.off(r("click")).removeData("plugin_"+e)},this.open=function(b){if(!b)throw new Error("Data for modal launch missing!");if(!b.link)throw new Error("Link to modal content missing!");switch(x(),V=m(b).appendTo(U),n(),_){case N.STATIC:aa.setContent(a(S).html()),p();break;case N.DYNAMIC:a.get(S).done(function(a){aa.setContent(a),p()}).fail(function(){q()});break;case N.UNOBTRUSIVE:F();break;default:throw new Error("Invalid modal type!")}},this.close=function(){t(),A(),j(),i(),h()},this.setContent=function(a){V.find("."+R.modalClass+O.elements.content).html(a),D()},M()}var e="iptModal";a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new d(this,b))})}}(jQuery,window,document);